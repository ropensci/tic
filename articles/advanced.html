<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced usage • tic</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced usage">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">tic</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.14.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tic.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introduction" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introduction</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introduction">
<li><a class="dropdown-item" href="../articles/features.html">Feature Overview</a></li>
    <li><a class="dropdown-item" href="../articles/build-lifecycle.html">The CI Build Lifecycle</a></li>
    <li><a class="dropdown-item" href="../articles/ci-client-packages.html">CI Client Packages</a></li>
    <li><a class="dropdown-item" href="../articles/ci-providers.html">CI Providers</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced">
<li><a class="dropdown-item" href="../articles/advanced.html">Advanced Usage</a></li>
    <li><a class="dropdown-item" href="../articles/deployment.html">Deployment</a></li>
    <li><a class="dropdown-item" href="../articles/custom-steps.html">Custom Steps</a></li>
    <li><a class="dropdown-item" href="../articles/updating.html">Updating Templates</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/tic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced usage</h1>
                        <h4 data-toc-skip class="author">Patrick
Schratz, Kirill Müller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tic/blob/main/vignettes/advanced.Rmd" class="external-link"><code>vignettes/advanced.Rmd</code></a></small>
      <div class="d-none name"><code>advanced.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="running-steps-conditionally">Running steps conditionally<a class="anchor" aria-label="anchor" href="#running-steps-conditionally"></a>
</h3>
<p>Steps and stages can be run conditionally using the control workflow
of {tic}. Possible conditionals are</p>
<ul>
<li>Environment variables of the build (queried by
<code><a href="../reference/ci.html">ci_is_env()</a></code>, <code><a href="../reference/ci.html">ci_has_env()</a></code> or
<code><a href="../reference/ci.html">ci_get_env()</a></code>).</li>
<li>R Version of the current build (<code><a href="https://rdrr.io/r/base/numeric_version.html" class="external-link">getRversion()</a></code>).</li>
<li>Other features of the build (e.g. branch name via
<code><a href="../reference/ci.html">ci_get_branch()</a></code>).</li>
</ul>
<p>Common tasks to use this feature are testing on multiple R versions
and the restriction of certain tasks that should only be executed once
(e.g. the <a href="deployment.html#pkgdown-deployment">deployment of a
{pkgdown} site</a>).</p>
<div class="section level4">
<h4 id="conditional-execution-use-cases">Conditional execution: Use cases<a class="anchor" aria-label="anchor" href="#conditional-execution-use-cases"></a>
</h4>
<p>The following shows some example code blocks to condition certain
stages and their respective steps on</p>
<ul>
<li>the CI service</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ci.html">ci_on_ghactions</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"&lt;stage&gt;"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu">step_...</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li>a specific branch</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ci.html">ci_get_branch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="st">"main"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"&lt;stage&gt;"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu">step_...</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="installation-of-packages">Installation of packages<a class="anchor" aria-label="anchor" href="#installation-of-packages"></a>
</h3>
<p>Required packages are installed based on the
“Depends”/“Imports”/“Suggests” fields of the <code>DESCRIPTION</code>
file. You should only use the following steps in extraordinary
circumstances. An example can be the use of a package in the
<code>README.Rmd</code> file which is not listed within the package’s
<code>DESCRIPTION</code> file.</p>
<div class="section level4">
<h4 id="github-packages">GitHub packages<a class="anchor" aria-label="anchor" href="#github-packages"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"install"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu"><a href="../reference/step_install_pkg.html">step_install_github</a></span><span class="op">(</span><span class="st">"r-lib/rcmdcheck"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that the underlying <code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github()</a></code> is
vectorized for the <code>repo</code> argument which means you can pass
all packages you want to install in a single function call:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu"><a href="../reference/step_install_pkg.html">step_install_github</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r-lib/rcmdcheck"</span>, <span class="st">"r-lib/usethis"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cran-packages">CRAN packages<a class="anchor" aria-label="anchor" href="#cran-packages"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"install"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu"><a href="../reference/step_install_pkg.html">step_install_cran</a></span><span class="op">(</span><span class="st">"magick"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="ci-meta-information">CI Meta-Information<a class="anchor" aria-label="anchor" href="#ci-meta-information"></a>
</h3>
<p>The <code><a href="../reference/ci.html">ci()</a></code> function and its friends (<code>ci_*</code>)
hold valuable information about the CI system. They can be used to query
information that can be again be utilized for conditioning stages or
steps.</p>
<p>For example, the user may wish to only deploy on GitHub Actions by
using <code><a href="../reference/ci.html">ci_on_ghactions()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ci.html">ci_on_ghactions</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"before_deploy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"deploy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>By using the code above, the specified steps will only be executed on
GitHub Actions. See <code><a href="../reference/ci.html">?ci</a></code> for more information on which CI
build information can be extracted from this function.</p>
</div>
<div class="section level3">
<h3 id="debugging-running-tic-locally">Debugging: Running {tic} locally<a class="anchor" aria-label="anchor" href="#debugging-running-tic-locally"></a>
</h3>
<div class="section level4">
<h4 id="checking-for-syntax-errors">Checking for syntax errors<a class="anchor" aria-label="anchor" href="#checking-for-syntax-errors"></a>
</h4>
<p>Before pushing to GitHub and triggering a CI build,
<code>tic.R</code> can be validated using <code><a href="../reference/dsl_get.html">dsl_load()</a></code>. This
function will source <code>tic.R</code> to check for possible problems.
If everything is ok, it will return (invisibly) a list with all stages
that will be run in the CI build. Here is a preview of the first two
stages:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dsl_get.html">dsl_load</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>✔ Loading tic stage configuration from tic.R</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dsl_get.html">dsl_get</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code>$before_install
── before_install ──────────────────────────────────────── stage ──
ℹ No steps defined

$install
── install ─────────────────────────────────────────────── stage ──
▶ step_install_github("ropensci/rotemplate")
▶ step_install_deps()</code></pre>
</div>
<div class="section level4">
<h4 id="emulating-a-ci-run-locally">Emulating a CI run locally<a class="anchor" aria-label="anchor" href="#emulating-a-ci-run-locally"></a>
</h4>
<p>A tic configuration can be emulated locally.</p>
<p>First, ensure that all prerequisites are met:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prepare_all_stages.html">prepare_all_stages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This might install additional packages, or even fail with a
descriptive message.</p>
<p>Then, run all steps defined in <code>tic.R</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_all_stages.html">run_all_stages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This emulates a CI run on your local machine by executing all stages
and their corresponding steps. Note that this action this will use your
local system libraries and not the CI environment. Only the steps that
are shown with <code><a href="../reference/dsl_get.html">dsl_get()</a></code> are executed. Some steps will not
be executed as they are conditioned to run on non-interactive
environments only, e.g. <code>add_step(covr::codcov())</code> added by
the macro <code><a href="../reference/do_package_checks.html">do_package_checks()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_all_stages.html">run_all_stages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>✓ Loading tic stage configuration from tic.R
Running install: step_install_github("ropensci/rotemplate")
Skipping install of 'rotemplate' from a github remote, the SHA1 (bec3e6eb) has not changed since last install.
  Use `force = TRUE` to force installation
Running install: step_install_deps()</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="debugging-entering-the-ci-build-directly">Debugging: Entering the CI build directly<a class="anchor" aria-label="anchor" href="#debugging-entering-the-ci-build-directly"></a>
</h3>
<div class="section level4">
<h4 id="circle-ci">Circle CI<a class="anchor" aria-label="anchor" href="#circle-ci"></a>
</h4>
<p>Debugging builds on Circle CI is very convenient. Go to the web
interface and click on the three dots as shown in the screenshot. Then
you can restart your build from the appearing dropdown menu and SSH into
the build.</p>
<p><img src="img/circleci-debug.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="whats-not-covered-yet">What’s not covered yet?<a class="anchor" aria-label="anchor" href="#whats-not-covered-yet"></a>
</h2>
<ul>
<li>
<code>SystemRequirements</code>: {tic} is not yet capable of
automatically determining system requirements specified in DESCRIPTION
files of an R package. Future plans include to automatically provide
suggestions like</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
