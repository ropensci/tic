<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced usage • tic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced usage">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.13.9012</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advantages.html">Why you should use tic</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">The CI build lifecycle</a>
    </li>
    <li>
      <a href="../articles/tic-usethis-travis.html">tic, travis and usethis</a>
    </li>
    <li>
      <a href="../articles/advanced.html">Advanced usage</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deployment</a>
    </li>
    <li>
      <a href="../articles/custom-steps.html">Custom steps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropenscilabs/tic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Advanced usage</h1>
                        <h4 class="author">Patrick Schratz, Kirill Müller</h4>
            
      
      <!--The 'toc' block was inserted manually by @pat-s. It triggeres the inline ToC in the vignettes.-->
            <div id="toc">
      <h3 class="hasAnchor">
<a href="#toc" class="anchor"></a>Table of Contents</h3>
      <ul>
<li>
<a href="#running-steps-conditionally">Running steps conditionally</a><ul>
<li><a href="#use-cases">Use cases</a></li>
      </ul>
</li>
      <li>
<a href="#installing-packages">Installing packages</a><ul>
<li><a href="#github-packages">GitHub packages</a></li>
      <li><a href="#cran-packages">CRAN packages</a></li>
      </ul>
</li>
      <li><a href="#ci-meta-information">CI Meta-Information</a></li>
      <li>
<a href="#troubleshooting-running-tic-locally">Troubleshooting: Running tic locally</a><ul>
<li><a href="#check-for-syntax-errors">Check for syntax errors</a></li>
      <li><a href="#emulate-a-ci-run-locally">Emulate a CI run locally</a></li>
      </ul>
</li>
      <li><a href="#troubleshooting-entering-the-ci-build">Troubleshooting: Entering the CI build</a></li>
      <li><a href="#whats-not-covered-yet">What’s not covered yet?</a></li>
      </ul>
</div>
      
      <small>Source: <a href="https://github.com/ropenscilabs/tic/blob/master/vignettes/advanced.Rmd"><code>vignettes/advanced.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="running-steps-conditionally" class="section level1">
<h1 class="hasAnchor">
<a href="#running-steps-conditionally" class="anchor"></a>Running steps conditionally</h1>
<p>Steps and stages can be run conditionally using the control workflow of <em>tic</em>. Possible conditionals are</p>
<ul>
<li>Environment variables of the build (queried by <code><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv()</a></code>)</li>
<li>R Version of the current build (<code><a href="https://www.rdocumentation.org/packages/base/topics/numeric_version">getRversion()</a></code>)</li>
<li>other features of the build (e.g. branch name, <code><a href="../reference/ci.html">ci_get_branch()</a></code>)</li>
</ul>
<p>The most common use cases are the testing on multiple R versions and the restriction of certain tasks that should only be executed once (e.g. the <a href="deployment.html#pkgdown-deployment">deployment of a <em>pkgdown</em> site</a>). If you test on multiple CI services you may also want to run certain tasks on only one of them.</p>
<div id="use-cases" class="section level2">
<h2 class="hasAnchor">
<a href="#use-cases" class="anchor"></a>Use cases</h2>
<p>The following shows you some example code blocks to condition certain stages and their respective steps on</p>
<ul>
<li>the R Version (using an env variable)</li>
<li>the CI service</li>
<li>a specific branch</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>(<span class="st">"TRAVIS_R_VERSION_STRING"</span>) <span class="op">==</span><span class="st"> "release"</span>) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"after_success"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="op">&lt;</span>do something<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">}</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">inherits</a></span>(<span class="kw"><a href="../reference/ci.html">ci</a></span>(), <span class="st">"TravisCI"</span>) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="op">&lt;</span>a stage<span class="op">&gt;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="op">&lt;</span>do something<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">}</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="cf">if</span> (<span class="kw"><a href="../reference/ci.html">ci_get_branch</a></span>() <span class="op">==</span><span class="st"> "master"</span>) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="op">&lt;</span>a stage<span class="op">&gt;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="op">&lt;</span>do something<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">}</a></code></pre></div>
</div>
</div>
<div id="installing-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#installing-packages" class="anchor"></a>Installing packages</h1>
<p>Note that manual installation of GitHub or CRAN packages should only be used in non-interactive CI runs. This can be checked with the condition <code><a href="../reference/ci.html">ci_is_interactive()</a></code>.</p>
<p>Usually required packages should be installed based on the DESCRIPTION file of a package. You should only use the following steps in extraordinary circumstances.</p>
<div id="github-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#github-packages" class="anchor"></a>GitHub packages</h2>
<p>GitHub packages should be installed in the <code>install</code> stage:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"install"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_install_pkg.html">step_install_github</a></span>(<span class="st">"r-lib/rcmdcheck"</span>))</a></code></pre></div>
<p>Note that the underlying <code><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">remotes::install_github()</a></code> is vectorized for the <code>repo</code> argument which means you can pass all packages you want to install in a single function call: <code><a href="../reference/DSL.html">add_step(step_install_github(c("r-lib/rcmdcheck", "r-lib/usethis")))</a></code>.</p>
</div>
<div id="cran-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#cran-packages" class="anchor"></a>CRAN packages</h2>
<p>Sometimes you need to install CRAN packages that are not specified in the DESCRIPTION file of your package. For example, to create a favicon in <em>pkgdown</em>, the <code>magick</code> package is required. To install the package (only if it does not exist in the cache already), run the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"install"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_install_pkg.html">step_install_cran</a></span>(<span class="st">"magick"</span>))</a></code></pre></div>
</div>
</div>
<div id="ci-meta-information" class="section level1">
<h1 class="hasAnchor">
<a href="#ci-meta-information" class="anchor"></a>CI Meta-Information</h1>
<p>The <code><a href="../reference/ci.html">ci()</a></code> function holds valuable information about the CI system. It can be used to query information that can be again be utilized for conditioning stages or steps.</p>
<p>For example, the user may wish to only deploy on Travis by using <code><a href="https://www.rdocumentation.org/packages/base/topics/class">inherits(ci(), "TravisCI")</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">inherits</a></span>(<span class="kw"><a href="../reference/ci.html">ci</a></span>(), <span class="st">"TravisCI"</span>)) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">}</a></code></pre></div>
<p>See <code><a href="../reference/ci.html">?ci</a></code> for more information on which information can be extracted from this function.</p>
</div>
<div id="troubleshooting-running-tic-locally" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting-running-tic-locally" class="anchor"></a>Troubleshooting: Running tic locally</h1>
<p><em>tic</em> can be emulated locally in two ways:</p>
<div id="check-for-syntax-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#check-for-syntax-errors" class="anchor"></a>Check for syntax errors</h2>
<p>You can run check on possible syntax errors in <code>tic.R</code> using <code><a href="../reference/load_from_file.html">load_from_file()</a></code>. This function will just source <code>tic.R</code> to check for possible misspecification errors. If everything is ok, it will return a list with all stages that are run in the CI build, formatted in the <code>R6</code> class style. Here is a preview of the first two stages:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/load_from_file.html">load_from_file</a></span>()[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="op">$</span>before_install</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="op">&lt;</span>Stage<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span>Public<span class="op">:</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">    </span>add_step<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (step, code) </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    add_task<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (run, <span class="dt">check =</span> <span class="ot">NULL</span>, <span class="dt">prepare =</span> <span class="ot">NULL</span>, <span class="dt">name =</span> <span class="ot">NULL</span>) </a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    clone<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (<span class="dt">deep =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    initialize<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (name) </a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    prepare_all<span class="op">:</span><span class="st"> </span><span class="cf">function</span> () </a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    reset<span class="op">:</span><span class="st"> </span><span class="cf">function</span> () </a>
<a class="sourceLine" id="cb8-10" data-line-number="10">    run_all<span class="op">:</span><span class="st"> </span><span class="cf">function</span> () </a>
<a class="sourceLine" id="cb8-11" data-line-number="11">  Private<span class="op">:</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">    </span>name<span class="op">:</span><span class="st"> </span>before_install</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">    prepare_one<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (step) </a>
<a class="sourceLine" id="cb8-14" data-line-number="14">    run_one<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (step) </a>
<a class="sourceLine" id="cb8-15" data-line-number="15">    steps<span class="op">:</span><span class="st"> </span>list</a>
<a class="sourceLine" id="cb8-16" data-line-number="16"></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="op">$</span>install</a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="op">&lt;</span>Stage<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="st">  </span>Public<span class="op">:</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="st">    </span>add_step<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (step, code) </a>
<a class="sourceLine" id="cb8-21" data-line-number="21">    add_task<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (run, <span class="dt">check =</span> <span class="ot">NULL</span>, <span class="dt">prepare =</span> <span class="ot">NULL</span>, <span class="dt">name =</span> <span class="ot">NULL</span>) </a>
<a class="sourceLine" id="cb8-22" data-line-number="22">    clone<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (<span class="dt">deep =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb8-23" data-line-number="23">    initialize<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (name) </a>
<a class="sourceLine" id="cb8-24" data-line-number="24">    prepare_all<span class="op">:</span><span class="st"> </span><span class="cf">function</span> () </a>
<a class="sourceLine" id="cb8-25" data-line-number="25">    reset<span class="op">:</span><span class="st"> </span><span class="cf">function</span> () </a>
<a class="sourceLine" id="cb8-26" data-line-number="26">    run_all<span class="op">:</span><span class="st"> </span><span class="cf">function</span> () </a>
<a class="sourceLine" id="cb8-27" data-line-number="27">  Private<span class="op">:</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="st">    </span>name<span class="op">:</span><span class="st"> </span>install</a>
<a class="sourceLine" id="cb8-29" data-line-number="29">    prepare_one<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (step) </a>
<a class="sourceLine" id="cb8-30" data-line-number="30">    run_one<span class="op">:</span><span class="st"> </span><span class="cf">function</span> (step) </a>
<a class="sourceLine" id="cb8-31" data-line-number="31">    steps<span class="op">:</span><span class="st"> </span>list</a></code></pre></div>
</div>
<div id="emulate-a-ci-run-locally" class="section level2">
<h2 class="hasAnchor">
<a href="#emulate-a-ci-run-locally" class="anchor"></a>Emulate a CI run locally</h2>
<p>To emulate a real CI run locally, you can call <code><a href="../reference/run_all_stages.html">run_all_stages()</a></code> and the stages and steps will be executed in your local R console. Note that doing this will of course use your local system libraries and not the CI environment.</p>
<p>Also some steps will not be executed as they are conditioned to run on non-interactive environments only, e.g. <code><a href="../reference/DSL.html">add_step(covr::codcov())</a></code> added by <code><a href="../reference/do_package_checks.html">do_package_checks()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">tic<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tic/topics/run_all_stages">run_all_stages</a></span>()</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">Running script<span class="op">:</span><span class="st"> </span><span class="kw"><a href="../reference/step_rcmdcheck.html">step_rcmdcheck</a></span>(<span class="dt">warnings_are_errors =</span> warnings_are_errors, <span class="dt">notes_are_errors =</span> notes_are_errors, <span class="dt">args =</span> args, <span class="dt">build_args =</span> build_args)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">── R CMD build ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">✔  checking <span class="cf">for</span> file ‘...<span class="op">/</span>DESCRIPTION’ ...</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">─  preparing ‘tic’<span class="op">:</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">✔  checking DESCRIPTION meta<span class="op">-</span>information ...</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">─  installing the package to build vignettes</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">✔  creating <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/vignette">vignettes</a></span> (<span class="fl">6.6</span>s)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">   Warning<span class="op">:</span><span class="st"> </span>‘inst<span class="op">/</span>doc’ file</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">       ‘tic<span class="op">-</span>usethis<span class="op">-</span>travis.R’</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">     ignored as vignettes have been rebuilt.</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">     Run R CMD build with <span class="op">--</span>no<span class="op">-</span>build<span class="op">-</span>vignettes to prevent rebuilding.</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">─  checking <span class="cf">for</span> LF line<span class="op">-</span>endings <span class="cf">in</span> source and make files and shell scripts</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">─  checking <span class="cf">for</span> empty or unneeded directories</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">─  building ‘tic_<span class="dv">0</span>.<span class="dv">2</span>.<span class="dv">13</span>.<span class="fl">9010.</span>tar.gz’</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">   </a>
<a class="sourceLine" id="cb9-17" data-line-number="17">── R CMD check ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">─  using log directory ‘<span class="op">/</span>tmp<span class="op">/</span>RtmpM4zdgT<span class="op">/</span>file12d42bb00e56<span class="op">/</span>tic.Rcheck’ (<span class="fl">1.2</span>s)</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">─  using R version <span class="dv">3</span>.<span class="fl">5.1</span> (<span class="dv">2018-07-02</span>)</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">─  using platform<span class="op">:</span><span class="st"> </span>x86_<span class="dv">64</span><span class="op">-</span>pc<span class="op">-</span>linux<span class="op">-</span><span class="kw">gnu</span> (<span class="dv">64</span><span class="op">-</span>bit)</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">─  using session charset<span class="op">:</span><span class="st"> </span>UTF<span class="dv">-8</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">─  using options ‘<span class="op">--</span>no<span class="op">-</span>manual <span class="op">--</span>as<span class="op">-</span>cran’</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">✔  checking <span class="cf">for</span> file ‘tic<span class="op">/</span>DESCRIPTION’</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">─  checking extension type ... Package</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">─  this is package ‘tic’ version ‘<span class="dv">0</span>.<span class="dv">2</span>.<span class="fl">13.9010</span>’</a>
<a class="sourceLine" id="cb9-26" data-line-number="26">─  package encoding<span class="op">:</span><span class="st"> </span>UTF<span class="dv">-8</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27">[...]</a></code></pre></div>
</div>
</div>
<div id="troubleshooting-entering-the-ci-build" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting-entering-the-ci-build" class="anchor"></a>Troubleshooting: Entering the CI build</h1>
<p>If your Travis build fails and you don’t understand why (error messages are too unspecific, you cannot reproduce the problem locally), you can ssh into the Travis build via SSH. To do so, your repository must be enabled for “ssh debugging”. This means you need to write the Travis CI team an e-mail, asking whether your repo can be <a href="https://docs.travis-ci.com/user/running-build-in-debug-mode/#enabling-debug-mode">activated for debugging</a>. Usually you get a reply within one day including additional information. However, rather than going the manual way, just take the easy route by calling <code><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis::travis_debug_job()</a></code>.</p>
<p>All it needs is the “Job ID” of the respective build you want to enter.</p>
<p><img src="img/travis-job-id.png" style="display: block; margin: auto;"></p>
<p>Rather than going to the web interface and getting the “Job ID” there, you can also do it from the command line. First, you need to query the overall “Build ID” of the run:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">travis<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis_get_builds</a></span>()</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ex">A</span> collection of 25 Travis CI builds:</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="ex">-</span> id: 416858821, number: 342, state: errored, duration: 3820, event_type: push, ...</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="ex">-</span> id: 416834229, number: 341, state: errored, duration: 3738, event_type: push, ...</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="ex">-</span> id: 416135954, number: 340, state: errored, duration: 3338, event_type: push, ...</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="ex">-</span> id: 416107143, number: 339, state: errored, duration: 3670, event_type: push, ...</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="ex">-</span> id: 416095854, number: 338, state: passed, duration: 3135, event_type: push, ...</a></code></pre></div>
<p>Because every “build” has multiple “Jobs”, you can now query the “Job ID”. For example, when you know that you want to debug the latest build, you can combine both commands:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">build_id &lt;-<span class="st"> </span>travis<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis_get_builds</a></span>()[[<span class="dv">1</span>]]<span class="op">$</span>id</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">travis<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis_get_jobs</a></span>(build_id)</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="ex">A</span> collection of 7 Travis CI jobs:</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ex">-</span> id: 416858822, allow_failure: FALSE, number: 342.1, state: passed, started_at: 2018-08-16T15:02:52Z, ...</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="ex">-</span> id: 416858823, allow_failure: FALSE, number: 342.2, state: passed, started_at: 2018-08-16T15:02:18Z, ...</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="ex">-</span> id: 416858824, allow_failure: FALSE, number: 342.3, state: passed, started_at: 2018-08-16T15:02:43Z, ...</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="ex">-</span> id: 416858825, allow_failure: FALSE, number: 342.4, state: passed, started_at: 2018-08-16T15:02:23Z, ...</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="ex">-</span> id: 416858826, allow_failure: FALSE, number: 342.5, state: passed, started_at: 2018-08-16T15:02:23Z, ...</a></code></pre></div>
<p>Finally, the build can be restarted by calling <code><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis::travis_debug_job()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">job_id &lt;-<span class="st"> </span>travis<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis_get_jobs</a></span>(build_id)[[<span class="dv">1</span>]]<span class="op">$</span>id</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">travis<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/travis/topics/travis_get_builds">travis_debug_job</a></span>(job_id)</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="ex">Finished</span> restarting debug job 416983664 from Travis CI.</a></code></pre></div>
<p>Wait a few minutes until the build arrives at the point when it shows the SSH command that can be used to ssh into the build. It should look similar to <code>ssh ukjiuCEkxBBnRAe32Y8xCH0zj@ny2.tmate.io</code>. If you still do not want to use the browser manually, simple call <code>travis::browse()</code> to open your project on Travis.</p>
<p>Once you are in the build you can use <code>bash</code> functions defined by Travis to to execute specific stages:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ex">travis_run_before_install</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="ex">travis_run_install</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="ex">travis_run_before_script</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="ex">travis_run_script</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="ex">travis_run_after_success</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="ex">travis_run_after_failure</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="ex">travis_run_after_script</span></a></code></pre></div>
<p>The debug session is a VM running a <a href="https://tmate.io/"><code>tmate</code></a> session. This makes it possible to use <code>tmux</code> commands, such as:</p>
<ul>
<li>Create multiple windows with <code>crtl-b c</code>.<br>
</li>
<li>Switch to a different window: <code>crtl-b &lt;window index&gt;</code> where the indices start with 0, 1, 2 and so on.<br>
</li>
<li>Scrolling up and down the history: <code>crtl-b [</code>. Press <code>q</code> to exit the scroll mode.</li>
</ul>
<p>See this <a href="https://tmuxcheatsheet.com/">cheatsheet</a> for more shortcuts.</p>
<p>Keep in mind that you only have 30 minutes before the VM will be terminated automatically.</p>
</div>
<div id="whats-not-covered-yet" class="section level1">
<h1 class="hasAnchor">
<a href="#whats-not-covered-yet" class="anchor"></a>What’s not covered yet?</h1>
<ul>
<li>
<code>SystemRequirements</code>: <em>tic</em> is not yet capable of automatically determining system requirements specified in DESCRIPTION files of an R package. Our plan is to automatically provide suggestions like “Please add <code>addons: apt: &lt;library&gt;</code> to <code>.travis.yml</code>”.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#running-steps-conditionally">Running steps conditionally</a><ul class="nav nav-pills nav-stacked">
<li><a href="#use-cases">Use cases</a></li>
      </ul>
</li>
      <li>
<a href="#installing-packages">Installing packages</a><ul class="nav nav-pills nav-stacked">
<li><a href="#github-packages">GitHub packages</a></li>
      <li><a href="#cran-packages">CRAN packages</a></li>
      </ul>
</li>
      <li><a href="#ci-meta-information">CI Meta-Information</a></li>
      <li>
<a href="#troubleshooting-running-tic-locally">Troubleshooting: Running tic locally</a><ul class="nav nav-pills nav-stacked">
<li><a href="#check-for-syntax-errors">Check for syntax errors</a></li>
      <li><a href="#emulate-a-ci-run-locally">Emulate a CI run locally</a></li>
      </ul>
</li>
      <li><a href="#troubleshooting-entering-the-ci-build">Troubleshooting: Entering the CI build</a></li>
      <li><a href="#whats-not-covered-yet">What’s not covered yet?</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, Mika Braginsky, Karthik Ram, Jeroen Ooms, Patrick Schratz, rOpenSci.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
