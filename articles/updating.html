<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Updating • tic</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Updating">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">tic</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.14.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tic.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introduction" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introduction</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introduction">
<li><a class="dropdown-item" href="../articles/features.html">Feature Overview</a></li>
    <li><a class="dropdown-item" href="../articles/build-lifecycle.html">The CI Build Lifecycle</a></li>
    <li><a class="dropdown-item" href="../articles/ci-client-packages.html">CI Client Packages</a></li>
    <li><a class="dropdown-item" href="../articles/ci-providers.html">CI Providers</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced">
<li><a class="dropdown-item" href="../articles/advanced.html">Advanced Usage</a></li>
    <li><a class="dropdown-item" href="../articles/deployment.html">Deployment</a></li>
    <li><a class="dropdown-item" href="../articles/custom-steps.html">Custom Steps</a></li>
    <li><a class="dropdown-item" href="../articles/updating.html">Updating Templates</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/tic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Updating</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tic/blob/main/vignettes/updating.Rmd" class="external-link"><code>vignettes/updating.Rmd</code></a></small>
      <div class="d-none name"><code>updating.Rmd</code></div>
    </div>

    
    
<p>{tic} comes with the convenience of providing YAML templates for
various CI providers which remove the need of studying YAML notations of
CI providers. The provided templates aim to work for most packages that
use plain R code. Packages that rely on system libraries (such as GDAL,
xml2) or link to other languages (such as Java) often need manual
additions within the YAML file.</p>
<p>However, making manual changes to such prohibits users from simply
updating to the latest upstream template that {tic} provides via
<code><a href="../reference/yaml_templates.html">yaml_templates()</a></code> because custom user changes would be
overwritten.</p>
<p>This often prevents users from updating to the most recent templates
provided by {tic} since a manual comparison between the current template
and the latest version is needed. {tic} 0.8.0 tackles this issue: The
new <code><a href="../reference/update_yml.html">update_yml()</a></code> enables updating of templates to the
latest version with <strong>user changes preserved</strong>.</p>
<p>Currently this only works for GitHub Actions as this provider enables
the inclusion of arbitrary custom blocks. {tic} extracts these blocks,
updates the template and then inserts the custom blocks at the correct
position back into the updated template. What may sound easy at first is
in fact a very complicated task behind the scenes: indentation needs to
preserved, some providers care about order and some do not accept
duplicate keys. While <code><a href="../reference/update_yml.html">update_yml()</a></code> supports GitHub Actions
and Circle CI right now for custom environment variables and user
blocks, the following rules need to be followed to ensure a smooth
experience.</p>
<p><strong>Shared Rules</strong></p>
<ul>
<li>All templates need to have an <em>identifier</em> and a <em>revision
date</em> in their first two lines.</li>
<li>Comments of custom env vars may only span one line.</li>
<li>All <em>custom env vars</em> need to have a comment (above the
actual env var) which includes the term <code>[Custom env]</code>.</li>
</ul>
<p><strong>GitHub Actions &amp; Circle CI</strong></p>
<ul>
<li>All <em>custom blocks</em> need to include
<code>[Custom block]</code> in their name tag,
e.g. <code>- name: "[Custom block] Test custom user block2"</code>.</li>
<li>Custom env vars unique to a runner need to include
<code>[Custom matrix env var]</code> in their tag,
e.g. <code># [Custom matrix env var] test</code>.</li>
</ul>
<p>All of these tags are used by {tic} to preserve user changes and
choose the right upstream template. During the process
<code><a href="../reference/update_yml.html">update_yml()</a></code> also prints how many custom blocks and env
vars were found. If you have some in your template and nothing is
printed when updating, something went wrong and you should double check
your template. In any case, it is recommended to review the changes to
avoid unexpected CI failures.</p>
<div class="section level2">
<h2 id="deviating-from-the-templates">Deviating from the templates<a class="anchor" aria-label="anchor" href="#deviating-from-the-templates"></a>
</h2>
<div class="section level3">
<h3 id="custom-and-custom-deploy-templates">
<code>custom</code> and <code>custom-deploy</code> templates<a class="anchor" aria-label="anchor" href="#custom-and-custom-deploy-templates"></a>
</h3>
<p>If you are using the <code>custom</code> or
<code>custom-deploy</code> deploy template (e.g. via
<code>tic::use_ghactions_yml("custom")</code>),
<code><a href="../reference/update_yml.html">tic::update_yml()</a></code> will ignore the matrix part of the
templates. This gives you the ability to specify your own runner config
while still profiting from template updates.</p>
</div>
<div class="section level3">
<h3 id="the-custom-header-tag">The <code># [Custom header]</code> tag<a class="anchor" aria-label="anchor" href="#the-custom-header-tag"></a>
</h3>
<p>If you want to go even more custom, you can add
<code># [Custom header]</code> right below the
<code>## revision date</code> line. This tells <code><a href="../reference/update_yml.html">update_yml()</a></code>
to ignore the complete header including the the <code>env:</code> key
completely. This can be useful if you want to insert a
<code>service:</code> block between <code>env:</code> and
<code>strategy</code> or when specifying custom build triggers in
<code>on:</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Here are some examples for custom user blocks and custom env
vars:</p>
<p><strong>GitHub Actions</strong></p>
<p><em>Custom header</em></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">## tic GitHub Actions template: linux</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">## revision date: 2022-08-28</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># [Custom header]</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">[</span><span class="at">...</span><span class="kw">]</span></span></code></pre></div>
<p><em>Runner specific environment variable</em></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="at">  </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">    # use a different tic template type if you do not want to build on all listed platforms</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> windows-latest</span><span class="kw">,</span><span class="at"> </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">"release"</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">    # [Custom matrix env var] test</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> macOS-latest</span><span class="kw">,</span><span class="at"> </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">"release"</span><span class="kw">,</span><span class="at"> </span><span class="fu">pkgdown</span><span class="kw">:</span><span class="at"> </span><span class="st">"true"</span><span class="kw">,</span><span class="at"> </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="st">"true"</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="kw">,</span><span class="at"> </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">"devel"</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="kw">,</span><span class="at"> </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">"release"</span><span class="at"> </span><span class="kw">}</span></span></code></pre></div>
<p><em>Environment variable</em></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">  # [Custom env]</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="at">  </span><span class="fu">R_MAX_NUM_DLLS</span><span class="kw">:</span><span class="at"> </span><span class="dv">999</span></span></code></pre></div>
<p><em>Block</em></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"[Custom block] [macOS] xquartz"</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="at">  </span><span class="fu">if</span><span class="kw">:</span><span class="at"> runner.os == 'macOS'</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">  run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    brew install xquartz</span></code></pre></div>
<p><strong>Circle CI</strong></p>
<p><em>Environment variable</em></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">  # [Custom env] env var 2</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">  </span><span class="fu">test2</span><span class="kw">:</span><span class="at"> </span><span class="st">"true"</span></span></code></pre></div>
<p><em>Block</em></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"[Custom block] test2"</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">    command</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>      echo 'test2'</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="automating-the-update-process">Automating the update process<a class="anchor" aria-label="anchor" href="#automating-the-update-process"></a>
</h2>
<p>Updating {tic} YAML files can be automated further. We provide a
GitHub Actions Workflow named <a href="https://github.com/ropensci/tic/blob/master/.github/workflows/update-tic.yml" class="external-link">update-tic.yml</a>
which can be used together with <code><a href="../reference/update_yml.html">tic::update_yml()</a></code> to update
the templates whenever there are newer upstream versions available. The
workflow will create a branch, update the files and commit them and even
open a pull request.</p>
<p>Just put this workflow next to any <code>tic.yml</code> file within
<code>.github/workflows/</code> and it will silently do its job. By
default it will run over night as a CRON job. It only runs once a day
and is not being executed on push or pull request events. The underlying
<code><a href="../reference/update_yml.html">update_yml()</a></code> will match all files starting with
<code>"tic"</code>. Hence you can add multiple YAML files with {tic}
support, e.g. <code>"tic.yml"</code> and <code>"tic-db.yml"</code>.</p>
<p>Unfortunately, GitHub does not allow GHA workflow files to be updated
and pushed by automatic approaches. To make this work, the user needs to
pass a GitHub Personal Access Token (PAT) with “workflow” scopes. This
PAT need to be added as a “secret” to the repo so that it can be used
within the build. <code><a href="../reference/gha_add_secret.html">gha_add_secret()</a></code> helps to automate this
process. The linked workflow searches by default for a PAT secret named
<code>TIC_UPDATE</code> when updating <code>tic.yml</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
