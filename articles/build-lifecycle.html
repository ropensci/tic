<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tic">
<title>Build lifecycle • tic</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Build lifecycle">
<meta property="og:description" content="tic">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">tic</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.13.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/tic.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-introduction">Introduction</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-introduction">
    <a class="dropdown-item" href="../articles/features.html">Feature Overview</a>
    <a class="dropdown-item" href="../articles/build-lifecycle.html">The CI Build Lifecycle</a>
    <a class="dropdown-item" href="../articles/ci-client-packages.html">CI Client Packages</a>
    <a class="dropdown-item" href="../articles/ci-providers.html">CI Providers</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-advanced">Advanced</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-advanced">
    <a class="dropdown-item" href="../articles/advanced.html">Advanced Usage</a>
    <a class="dropdown-item" href="../articles/deployment.html">Deployment</a>
    <a class="dropdown-item" href="../articles/custom-steps.html">Custom Steps</a>
    <a class="dropdown-item" href="../articles/updating.html">Updating Templates</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Build lifecycle</h1>
                        <h4 data-toc-skip class="author">Patrick
Schratz, Kirill Müller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tic/blob/HEAD/vignettes/build-lifecycle.Rmd" class="external-link"><code>vignettes/build-lifecycle.Rmd</code></a></small>
      <div class="d-none name"><code>build-lifecycle.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="stages">Stages<a class="anchor" aria-label="anchor" href="#stages"></a>
</h2>
<p>CI services run builds in stages. Stages are usually ordered as
follows:</p>
<p><img src="img/build-lifecycle.png" style="display: block; margin: auto;"></p>
<p>The <code>after_xxx</code> stages are executed conditionally after
their corresponding <code>xxx</code> stage.</p>
<ul>
<li>The <code>after_deploy</code> stage will only be run if the
<code>deploy</code> stage was run before.</li>
<li>The <code>after_success</code> stage will only be run if the
<code>script</code> stage executed successfully, i.e. without error;
otherwise <code>after_failure</code> will be run instead.</li>
</ul>
<p><em>tic</em> also relies on a “stage” based approach. All action that
should be run in a certain stage are defined in <code>tic.R</code>. The
steps are specified in an CI-agnostic way using R syntax.</p>
<p>The majority of the template code consists of glue code and is not
meant to be edited.</p>
<p>In a nutshell, the workflow is as follows:</p>
<p>CI YAML -&gt; <code>tic.R</code> -&gt; commands/steps to execute</p>
<p>Some important points:</p>
<ul>
<li>The R code declared in <code>tic.R</code> is not meant to be run
manually. It also does not trigger a CI build. All commands just define
the workflow of the CI build.</li>
<li>The workflow can be loaded using <code><a href="../reference/dsl_get.html">dsl_load()</a></code>, however
this will not run any of the commands defined.</li>
<li>For testing purposes, all stages and steps defined in
<code>tic.R</code> can be executed by calling
<code><a href="../reference/run_all_stages.html">run_all_stages()</a></code>. This emulates a CI build on your local
system. See <a href="advanced#troubleshooting-running-tic-locally">Troubleshooting:
Running tic locally</a> for more information.</li>
</ul>
<div class="section level3">
<h3 id="accessing-a-single-stage">Accessing a single stage<a class="anchor" aria-label="anchor" href="#accessing-a-single-stage"></a>
</h3>
<p>The steps which are executed in each stage are specified in
<code>tic.R</code>. A stage is executed by calling the respective
<em>tic</em> function; for example for stage “deploy”
<code><a href="../reference/stages.html">tic::deploy()</a></code>. This is what happens in the CI YAML
templates if you take a closer look at them.</p>
<p>These functions then source <code>tic.R</code> and collect all steps
which belong to their stage by executing
<code>get_stage("&lt;stage name&gt;")</code>
(e.g. <code>get_stage("deploy")</code> for the “deploy” stage”).</p>
<p>Again, remember that the order of the stages is fixed (see the <a href="#stages">“Stages”</a> section), it does not matter in which order
you declare the stages in <code>tic.R</code>.</p>
</div>
<div class="section level3">
<h3 id="details-of-stages">Details of stages<a class="anchor" aria-label="anchor" href="#details-of-stages"></a>
</h3>
<div class="section level4">
<h4 id="the-before_install-install-stages">The <code>"before_install"</code> &amp; <code>"install"</code>
stages<a class="anchor" aria-label="anchor" href="#the-before_install-install-stages"></a>
</h4>
<p>An important stage for {tic} is the <code>"before_install"</code>
stage. Here, {tic} itself gets installed and runs
<code><a href="../reference/prepare_all_stages.html">prepare_all_stages()</a></code>. This function ensures that all
subsequent steps can be executed. Under the hood the
<code>prepare()</code> method of all steps that were declared in
<code>tic.R</code> is being called. For example, the
<code>prepare()</code> method of the <code><a href="../reference/step_rcmdcheck.html">step_rcmdcheck()</a></code> step
ensures that all dependencies of an R package get installed by calling
<code><a href="https://remotes.r-lib.org/reference/install_deps.html" class="external-link">remotes::install_deps()</a></code>.</p>
<p>All packages that should be stored in the “cache” of the CI service
(so that they do not need to be installed again on every CI build)
should be installed during preparation.</p>
</div>
<div class="section level4">
<h4 id="the-script-stage">The <code>"script"</code> stage<a class="anchor" aria-label="anchor" href="#the-script-stage"></a>
</h4>
<p>The <code>"script"</code> stage is responsible for executing the
important tasks of the CI run: Typically, it runs
<code>R CMD check</code> for a package or builds the site for a blogdown
site. When arriving at this stage, all dependencies for a successful run
are already installed.</p>
</div>
<div class="section level4">
<h4 id="the-deploy-stage">The <code>"deploy"</code> stage<a class="anchor" aria-label="anchor" href="#the-deploy-stage"></a>
</h4>
<p>This stage initiates the deployment (e.g., setting up deployment
keys) and executes it. If you want to automatically build a {pkgdown}
site, you can do it here. See <a href="deployment.html">the article
about deployment</a> for more information.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="steps">Steps<a class="anchor" aria-label="anchor" href="#steps"></a>
</h2>
<p>Steps are the commands that are executed in each stage. <em>tic</em>
uses the <a href="https://magrittr.tidyverse.org/" class="external-link">pipe operator</a> and
the <code><a href="../reference/dsl.html">add_step()</a></code> function to chain steps in
<code>tic.R</code>, for example</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dsl.html">get_stage</a></span><span class="op">(</span><span class="st">"deploy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dsl.html">add_step</a></span><span class="op">(</span><span class="fu"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the code example above <code><a href="../reference/step_build_pkgdown.html">step_build_pkgdown()</a></code> is added
to the <code>"deploy"</code> stage and subsequently only run in this
stage. More steps that should be run in this stage could just by piped
after <code>add_step(step_build_pkgdown())</code>. In summary, steps are
usually defined using two nested commands: <code><a href="../reference/dsl.html">add_step()</a></code> and
the corresponding step, here <code><a href="../reference/step_build_pkgdown.html">step_build_pkgdown()</a></code>.</p>
<p>Here is a list that shows a rough grouping of the steps into their
default stages:</p>
<div class="section level4">
<h4 id="basic">Basic<a class="anchor" aria-label="anchor" href="#basic"></a>
</h4>
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/step_hello_world.html">step_hello_world()</a></code></td>
<td>Print “Hello, World!” to the console, helps testing a tic setup</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_write_text_file.html">step_write_text_file()</a></code></td>
<td>Creates a text file with arbitrary contents</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/step_install_pkg.html">step_install_cran()</a></code></td>
<td>Installs one package from CRAN via <code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code>
if it is not yet installed.</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_install_pkg.html">step_install_github()</a></code></td>
<td>Installs one or more packages from GitHub via
<code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github()</a></code>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="r-package-specific">R package specific<a class="anchor" aria-label="anchor" href="#r-package-specific"></a>
</h4>
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/step_build_pkgdown.html">step_build_pkgdown()</a></code></td>
<td>Building package documentation via <a href="https://github.com/r-lib/pkgdown" class="external-link">pkgdown</a>
</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_rcmdcheck.html">step_rcmdcheck()</a></code></td>
<td>Run <code>R CMD check</code> via the {rcmdcheck} package</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="deployment">Deployment<a class="anchor" aria-label="anchor" href="#deployment"></a>
</h4>
<table class="table">
<colgroup>
<col width="14%">
<col width="85%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>step_install_ssh_key()</code></td>
<td>Make available a private SSH key (which has been added before to
your project by <code><a href="../reference/use_tic.html">use_tic()</a></code> or
<code><a href="../reference/use_ghactions_deploy.html">tic::use_ghactions_deploy()</a></code>).</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_test_ssh.html">step_test_ssh()</a></code></td>
<td>Test the SSH connection to GitHub, helps troubleshooting deploy
problems.</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/step_setup_ssh.html">step_setup_ssh()</a></code></td>
<td>Adds to known hosts, installs private key, and tests the
connection.</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_setup_push_deploy.html">step_setup_push_deploy()</a></code></td>
<td>Clones a repo, initiates author information, and sets up remotes for
a subsequent <code><a href="../reference/step_do_push_deploy.html">step_do_push_deploy()</a></code>.</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/step_do_push_deploy.html">step_do_push_deploy()</a></code></td>
<td>Deploy to GitHub.</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code></td>
<td>Combines <code><a href="../reference/step_setup_push_deploy.html">step_setup_push_deploy()</a></code> and
<code><a href="../reference/step_do_push_deploy.html">step_do_push_deploy()</a></code>.</td>
</tr>
</tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://twitter.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
