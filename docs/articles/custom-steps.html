<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Developer info: Writing custom steps • tic</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Developer info: Writing custom steps">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tic</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.13.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tic-advantages.html">tic advantages</a>
    </li>
    <li>
      <a href="../articles/tic-usethis-travis.html">tic, travis and usethis</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">Build lifecycle</a>
    </li>
    <li>
      <a href="../articles/advanced.html">Advanced usage</a>
    </li>
    <li>
      <a href="../articles/custom-steps.html">Dev - custom steps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropenscilabs/tic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Developer info: Writing custom steps</h1>
                        <h4 class="author">Kirill Müller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropenscilabs/tic/blob/master/vignettes/custom-steps.Rmd"><code>vignettes/custom-steps.Rmd</code></a></small>
      <div class="hidden name"><code>custom-steps.Rmd</code></div>

    </div>

    
    
<p>Most steps run on CI systems are <a href="tic.html#steps">already implemented</a> into <code>tic</code>. The following vignette shows how new steps can be created and how <code>tic</code> defines them. Internally, all steps are defined as <a href="https://github.com/wch/R6">R6</a> classes. A step is an environment-like (or list-like) object with named members <code>check</code>, <code>prepare</code>, and <code>run</code>. These members should be functions that are callable without arguments.</p>
<p>The base class of a step that is <code>TicStep</code>. All steps defined by tic, including the example <code>HelloWorld</code> step, use <code>TicStep</code> as the base class. See <a href="https://github.com/ropenscilabs/tic/blob/master/R/steps-base.R"><code>steps-base.R</code></a> for the implementation. The <code>step_...</code> functions in tic are simply the <code>new()</code> methods of the corresponding R6 class objects. We recommend following the same pattern for your custom steps.</p>
<p>In the following, we describe the three methods which your derived step class must override:</p>
<div id="check" class="section level3">
<h3 class="hasAnchor">
<a href="#check" class="anchor"></a><code>check()</code>
</h3>
<p>This function should return a logical scalar. The task will be prepared and run only if this function returns <code>TRUE</code>. Step <code>ssh_add_to_known_hosts()</code> uses this functionality to <a href="https://github.com/ropenscilabs/tic/blob/a328680ba37d7a83c98a853c00240bbcbe2b01a3/R/steps-ssh.R#L77-L78">check</a> if the environment is non-interactive and if the “id_rsa” environment variable is available.</p>
</div>
<div id="prepare" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare" class="anchor"></a><code>prepare()</code>
</h3>
<p>This method will be called by <code><a href="../reference/stages.html">before_script()</a></code>. It is intended to run in the <code>before_script</code> phase of the CI run. You should install all dependent packages here, which then can be cached by the CI system. You also may include further preparation code here. For example <code>step_rcmdcheck</code> verifies that the R package <code>rcmdcheck</code> is installed in this <a href="https://github.com/ropenscilabs/tic/blob/a328680ba37d7a83c98a853c00240bbcbe2b01a3/R/steps-rcmdcheck.R#L26-L27">method</a>.</p>
</div>
<div id="run" class="section level3">
<h3 class="hasAnchor">
<a href="#run" class="anchor"></a><code>run()</code>
</h3>
<p>This method holds the commands that execute the essential calls in the end. It is called when a new element of that step class is created, e.g. <code>RCMDcheck$new</code>. For example, the <code>run()</code> function of class <code>RCMDcheck</code> looks as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">run =<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">res &lt;-<span class="st"> </span>rcmdcheck<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rcmdcheck/topics/rcmdcheck">rcmdcheck</a></span>(<span class="dt">args =</span> private<span class="op">$</span>args)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="kw">print</span>(res)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="cf">if</span> (<span class="kw">length</span>(res<span class="op">$</span>errors) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="kw">stopc</span>(<span class="st">"Errors found."</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="cf">if</span> (private<span class="op">$</span>warnings_are_errors <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(res<span class="op">$</span>warnings) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="kw">stopc</span>(<span class="st">"Warnings found, and warnings_are_errors is set."</span>)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  <span class="cf">if</span> (private<span class="op">$</span>notes_are_errors <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(res<span class="op">$</span>notes) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    <span class="kw">stopc</span>(<span class="st">"Notes found, and notes_are_errors is set."</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"> }</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">}</a></code></pre></div>
<p>If you are unfamiliar with <code>R6</code> classes, here is a short guidance how the arguments are passed onto each function: Consider function <a href="https://github.com/ropenscilabs/tic/blob/master/R/steps-rcmdcheck.R">step_rcmdcheck()</a>. The user input first goes into</p>
<pre><code>step_rcmdcheck &lt;- function(warnings_are_errors = TRUE, notes_are_errors = FALSE,
                           args = "--no-manual --as-cran") </code></pre>
<p>Here, a new instance of the defined <code>R6</code> class “RCMDcheck” is initiated with <code>RCMDcheck$new()</code>. These arguments are then passed onto the <code>initialize()</code> function of the <code>R6</code> class. Here, the arguments are assigned to the “private” objects (e.g. <code>private$args</code>). Next, the private objects are used in the <code>run()</code> function which does the actual work in the end. You can read more about <code>R6</code> in Hadley’s <a href="https://adv-r.hadley.nz/r6.html">book</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, Mika Braginsky, Karthik Ram, Jeroen Ooms, Patrick Schratz, rOpenSci.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
