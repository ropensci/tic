<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Build and deploy drat repository — do_drat • tic</title><!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Build and deploy drat repository — do_drat"><meta name="description" content='do_drat() builds and deploys R packages to a drat repository and adds
default steps to the "install", "before_deploy" and "deploy" stages:

step_setup_ssh() in the "before_deploy" to setup
the upcoming deployment
step_setup_push_deploy() in the "before_deploy" stage
(if deploy is set),
step_add_to_drat() in the "deploy"
step_do_push_deploy() in the "deploy" stage.

'><meta property="og:description" content='do_drat() builds and deploys R packages to a drat repository and adds
default steps to the "install", "before_deploy" and "deploy" stages:

step_setup_ssh() in the "before_deploy" to setup
the upcoming deployment
step_setup_push_deploy() in the "before_deploy" stage
(if deploy is set),
step_add_to_drat() in the "deploy"
step_do_push_deploy() in the "deploy" stage.

'><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css"><script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">tic</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.14.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tic.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introduction" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introduction</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introduction"><li><a class="dropdown-item" href="../articles/features.html">Feature Overview</a></li>
    <li><a class="dropdown-item" href="../articles/build-lifecycle.html">The CI Build Lifecycle</a></li>
    <li><a class="dropdown-item" href="../articles/ci-client-packages.html">CI Client Packages</a></li>
    <li><a class="dropdown-item" href="../articles/ci-providers.html">CI Providers</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced"><li><a class="dropdown-item" href="../articles/advanced.html">Advanced Usage</a></li>
    <li><a class="dropdown-item" href="../articles/deployment.html">Deployment</a></li>
    <li><a class="dropdown-item" href="../articles/custom-steps.html">Custom Steps</a></li>
    <li><a class="dropdown-item" href="../articles/updating.html">Updating Templates</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/tic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Build and deploy drat repository</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tic/blob/main/R/macro-drat.R" class="external-link"><code>R/macro-drat.R</code></a></small>
      <div class="d-none name"><code>do_drat.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>do_drat()</code> builds and deploys R packages to a drat repository and adds
default steps to the <code>"install"</code>, <code>"before_deploy"</code> and <code>"deploy"</code> stages:</p>
<ol><li><p><code><a href="step_setup_ssh.html">step_setup_ssh()</a></code> in the <code>"before_deploy"</code> to setup
the upcoming deployment</p></li>
<li><p><code><a href="step_setup_push_deploy.html">step_setup_push_deploy()</a></code> in the <code>"before_deploy"</code> stage
(if <code>deploy</code> is set),</p></li>
<li><p><code><a href="step_add_to_drat.html">step_add_to_drat()</a></code> in the <code>"deploy"</code></p></li>
<li><p><code><a href="step_do_push_deploy.html">step_do_push_deploy()</a></code> in the <code>"deploy"</code> stage.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">do_drat</span><span class="op">(</span></span>
<span>  repo_slug <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  orphan <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  checkout <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  path <span class="op">=</span> <span class="st">"~/git/drat"</span>,</span>
<span>  branch <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  remote_url <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  commit_message <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  commit_paths <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  force <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  private_key_name <span class="op">=</span> <span class="st">"TIC_DEPLOY_KEY"</span>,</span>
<span>  deploy_dev <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-repo-slug">repo_slug<a class="anchor" aria-label="anchor" href="#arg-repo-slug"></a></dt>
<dd><p><code>[string]</code><br>
The name of the drat repository to deploy to in the form <code>:owner/:repo</code>.</p></dd>


<dt id="arg-orphan">orphan<a class="anchor" aria-label="anchor" href="#arg-orphan"></a></dt>
<dd><p><code>[flag]</code><br>
Create and force-push an orphan branch consisting of only one commit?
This can be useful e.g. for <code>path = "docs", branch = "gh-pages"</code>,
but cannot be applied for pushing to the current branch.</p></dd>


<dt id="arg-checkout">checkout<a class="anchor" aria-label="anchor" href="#arg-checkout"></a></dt>
<dd><p><code>[flag]</code><br>
Check out the current contents of the repository? Defaults to <code>TRUE</code>,
set to <code>FALSE</code> if the build process relies on existing contents or
if you deploy to a different branch.</p></dd>


<dt id="arg-path-branch">path, branch<a class="anchor" aria-label="anchor" href="#arg-path-branch"></a></dt>
<dd><p>By default, this macro deploys the default repo branch
(usually "master") of the drat repository.
An alternative option is <code>"gh-pages"</code>.</p></dd>


<dt id="arg-remote-url">remote_url<a class="anchor" aria-label="anchor" href="#arg-remote-url"></a></dt>
<dd><p><code>[string]</code><br>
The URL of the remote Git repository to push to, defaults to the
current GitHub repository.</p></dd>


<dt id="arg-commit-message">commit_message<a class="anchor" aria-label="anchor" href="#arg-commit-message"></a></dt>
<dd><p><code>[string]</code><br>
Commit message to use, defaults to a useful message linking to the CI build
and avoiding recursive CI runs.</p></dd>


<dt id="arg-commit-paths">commit_paths<a class="anchor" aria-label="anchor" href="#arg-commit-paths"></a></dt>
<dd><p><code>[character]</code><br>
Restrict the set of directories and/or files added to Git before deploying.
Default: deploy all files.</p></dd>


<dt id="arg-force">force<a class="anchor" aria-label="anchor" href="#arg-force"></a></dt>
<dd><p><code>[logical]</code><br>
Add <code>--force</code> flag to git commands?</p></dd>


<dt id="arg-private-key-name">private_key_name<a class="anchor" aria-label="anchor" href="#arg-private-key-name"></a></dt>
<dd><p><code>string</code><br>
Only needed when deploying from builds on GitHub Actions.
If you have set a custom name for the private key during creation of the
SSH key pair via tic::use_ghactions_deploy()] or <code><a href="use_tic.html">use_tic()</a></code>, pass this
name here.</p></dd>


<dt id="arg-deploy-dev">deploy_dev<a class="anchor" aria-label="anchor" href="#arg-deploy-dev"></a></dt>
<dd><p><code>[logical]</code><br>
Should development versions of packages also be deployed to the drat repo?
By default only "major", "minor" and "patch" releases are build and
deployed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="deployment">Deployment<a class="anchor" aria-label="anchor" href="#deployment"></a></h2>


<p>Deployment can only happen to the default repo branch (usually "master") or
<code>gh-pages</code> branch because the GitHub Pages functionality from GitHub is
used to access the drat repository later on. You need to enable this
functionality when creating the drat repository on GitHub via <code>Settings -&gt; GitHub pages</code> and set it to the chosen setting here.</p>
<p>To build and deploy Windows and macOS binaries, builds with deployment
permissions need to be triggered.
Have a look at
<a href="https://docs.ropensci.org/tic/articles/deployment.html" class="external-link">https://docs.ropensci.org/tic/articles/deployment.html</a> for
more information and instructions.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other macros:
<code><a href="do_blogdown.html">do_blogdown</a>()</code>,
<code><a href="do_bookdown.html">do_bookdown</a>()</code>,
<code><a href="do_package_checks.html">do_package_checks</a>()</code>,
<code><a href="do_pkgdown.html">do_pkgdown</a>()</code>,
<code><a href="do_readme_rmd.html">do_readme_rmd</a>()</code>,
<code><a href="list_macros.html">list_macros</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dsl_get.html">dsl_init</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">do_drat</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="dsl_get.html">dsl_get</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>





  </body></html>

